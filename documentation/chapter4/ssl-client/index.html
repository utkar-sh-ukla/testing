<!doctype html><html><head><meta charset=utf-8><title>Pgjdbc</title><link rel=stylesheet href=https://utkar-sh-ukla.github.io/testing/sass/main.e946902265096118ab63cb74d4453d2690cb98e02350ac6ad40325a645b55613.css integrity="sha256-6UaQImUJYRirY8t01EU9JpDLmOAjUKxq1AMlpkW1VhM="><link rel=icon href=/testing/favicon.ico></head><body><nav class=nav><a href=/testing><img src=/images/postgreslogo.svg></a><div class=nav__items><a class=nav__item href=/testing/development/>Development</a>
<a class=nav__item href=/testing/download/>Download</a>
<a class=nav__item href=/testing/documentation/>Documentation</a>
<a class=nav__item href=/testing/community/>Community</a></div><a href=https://github.com/pgjdbc/pgjdbc><img src=/images/github.svg></a></nav><main><div class=flex><nav role=navigation class=side__nav><ul><li><a href=/testing/documentation/chapter1/>Introduction</a><ul><li><a href=/testing/documentation/chapter1/intro/>Introduction</a></li></ul></li><li><a href=/testing/documentation/chapter2/>Setting up the JDBC Driver</a><ul><li><a href=/testing/documentation/chapter2/setup/>Getting the Driver</a></li><li><a href=/testing/documentation/chapter2/classpath/>Setting up the Class Path</a></li><li><a href=/testing/documentation/chapter2/prepare/>Preparing the Database Server for JDBC</a></li><li><a href=/testing/documentation/chapter2/your-database/>Creating a Database</a></li></ul></li><li><a href=/testing/documentation/chapter3/>Initializing the Driver</a><ul><li><a href=/testing/documentation/chapter3/use/>Importing JDBC</a></li><li><a href=/testing/documentation/chapter3/load/>Loading the Driver</a></li><li><a href=/testing/documentation/chapter3/connect/>Connecting to the Database</a></li></ul></li><li><a href=/testing/documentation/chapter4/>Using SSL</a><ul><li><a href=/testing/documentation/chapter4/ssl/>Configuring the Server</a></li><li><a href=/testing/documentation/chapter4/ssl-client/>Configuring the Client</a></li><li><a href=/testing/documentation/chapter4/ssl-factory/>Custom SSLSocketFactory</a></li></ul></li><li><a href=/testing/documentation/chapter5/>Issuing a Query and Processing the Result</a><ul><li><a href=/testing/documentation/chapter5/query/>Issuing a Query and Processing the Result</a></li><li><a href=/testing/documentation/chapter5/statement/>Using the Statement or PreparedStatement Interface</a></li><li><a href=/testing/documentation/chapter5/resultset/>Using the ResultSet Interface</a></li><li><a href=/testing/documentation/chapter5/update/>Performing Updates</a></li><li><a href=/testing/documentation/chapter5/ddl/>Creating and Modifying Database Objects</a></li><li><a href=/testing/documentation/chapter5/java8-date-time/>Using Java 8 Date and Time classes</a></li></ul></li><li><a href=/testing/documentation/chapter6/>Calling Stored Functions and Procedures</a><ul><li><a href=/testing/documentation/chapter6/callproc/>Calling Stored Functions and Procedures</a></li></ul></li><li><a href=/testing/documentation/chapter7/>Storing Binary Data</a><ul><li><a href=/testing/documentation/chapter7/binary-data/>Storing Binary Data</a></li></ul></li><li><a href=/testing/documentation/chapter8/>JDBC escapes</a><ul><li><a href=/testing/documentation/chapter8/escapes/>JDBC escapes</a></li><li><a href=/testing/documentation/chapter8/outer-joins-escape/>Escape for outer joins</a></li><li><a href=/testing/documentation/chapter8/escapes-datetime/>Date-time escapes</a></li><li><a href=/testing/documentation/chapter8/escaped-functions/>Escaped scalar functions</a></li></ul></li><li><a href=/testing/documentation/chapter9/>PostgreSQL™ Extensions to the JDBC API</a><ul><li><a href=/testing/documentation/chapter9/ext/>PostgreSQL™ Extensions to the JDBC API</a></li><li><a href=/testing/documentation/chapter9/geometric/>Geometric Data Types</a></li><li><a href=/testing/documentation/chapter9/largeobjects/>Large Objects</a></li><li><a href=/testing/documentation/chapter9/listennotify/>Listen / Notify</a></li><li><a href=/testing/documentation/chapter9/server-prepare/>Server Prepared Statements</a></li><li><a href=/testing/documentation/chapter9/parameterstatus/>Parameter Status Messages</a></li><li><a href=/testing/documentation/chapter9/replication/>Physical and Logical replication API</a></li><li><a href=/testing/documentation/chapter9/arrays/>Arrays</a></li></ul></li><li><a href=/testing/documentation/chapter10/>Using the Driver in a Multithreaded or a Servlet Environment</a><ul><li><a href=/testing/documentation/chapter10/thread/>Using the Driver in a Multithreaded or a Servlet Environment</a></li></ul></li><li><a href=/testing/documentation/chapter11/>Connection Pools and Data Sources</a><ul><li><a href=/testing/documentation/chapter11/datasource/>Connection Pools and Data Sources</a></li><li><a href=/testing/documentation/chapter11/ds-cpds/>Application Servers ConnectionPoolDataSource</a></li><li><a href=/testing/documentation/chapter11/ds-ds/>Applications DataSource</a></li><li><a href=/testing/documentation/chapter11/jndi/>Data Sources and JNDI</a></li><li><a href=/testing/documentation/chapter11/tomcat/>Tomcat setup</a></li></ul></li><li><a href=/testing/documentation/chapter12/>Logging using java.util.logging</a><ul><li><a href=/testing/documentation/chapter12/logging/>Logging using java.util.logging</a></li></ul></li><li><a href=/testing/documentation/chapter13/>Further Reading</a><ul><li><a href=/testing/documentation/chapter13/reading/>Further Reading</a></li></ul></li></ul></nav><article><h1>Configuring the Client</h1><br><p>There are a number of connection parameters for configuring the client for SSL. See <a href=/documentation/chapter3/connect/#ssl>SSL Connection parameters</a></p><p>The simplest being <code>ssl=true</code>, passing this into the driver will cause the driver to validate both
the SSL certificate and verify the hostname (same as <code>verify-full</code>). <strong>Note</strong> this is different than
libpq which defaults to a non-validating SSL connection.</p><p>In this mode, when establishing a SSL connection the JDBC driver will validate the server&rsquo;s
identity preventing &ldquo;man in the middle&rdquo; attacks. It does this by checking that the server
certificate is signed by a trusted authority, and that the host you are connecting to is the
same as the hostname in the certificate.</p><p>If you <strong>require</strong> encryption and want the connection to fail if it can&rsquo;t be encrypted then set
<code>sslmode=require</code> this ensures that the server is configured to accept SSL connections for this
Host/IP address and that the server recognizes the client certificate. In other words if the server
does not accept SSL connections or the client certificate is not recognized the connection will fail.
<strong>Note</strong> in this mode we will accept all server certificates.</p><p>If <code>sslmode=verify-ca</code>, the server is verified by checking the certificate chain up to the root
certificate stored on the client.</p><p>If <code>sslmode=verify-full</code>, the server host name will be verified to make sure it matches the name
stored in the server certificate.</p><p>The SSL connection will fail if the server certificate cannot be verified. <code>verify-full</code> is recommended
in most security-sensitive environments.</p><p>The default SSL Socket factory is the LibPQFactory
In the case where the certificate validation is failing you can try <code>sslcert=</code> and LibPQFactory will
not send the client certificate. If the server is not configured to authenticate using the certificate
it should connect.</p><p>The location of the client certificate, the PKCS-8 client key and root certificate can be overridden with the
<code>sslcert</code>, <code>sslkey</code>, and <code>sslrootcert</code> settings respectively. These default to /defaultdir/postgresql.crt,
/defaultdir/postgresql.pk8, and /defaultdir/root.crt respectively where defaultdir is
${user.home}/.postgresql/ in *nix systems and %appdata%/postgresql/ on windows</p><p>As of version 42.2.9 PKCS-12 is also supported. In this archive format the client key and the client
certificate are in one file, which needs to be set with the <code>sslkey</code> parameter. For the PKCS-12 format
to be recognized, the file extension must be &ldquo;.p12&rdquo; (supported since 42.2.9) or &ldquo;.pfx&rdquo; (since 42.2.16).
(In this case the <code>sslcert</code> parameter is ignored.)</p><p>Finer control of the SSL connection can be achieved using the <code>sslmode</code> connection parameter.
This parameter is the same as the libpq <code>sslmode</code> parameter and currently implements the
following</p><table><thead><tr><th>sslmode</th><th>Eavesdropping Protection</th><th>MITM Protection</th><th></th></tr></thead><tbody><tr><td>disable</td><td>No</td><td>No</td><td>I don&rsquo;t care about security and don&rsquo;t want to pay the overhead for encryption</td></tr><tr><td>allow</td><td>Maybe</td><td>No</td><td>I don&rsquo;t care about security but will pay the overhead for encryption if the server insists on it</td></tr><tr><td>prefer</td><td>Maybe</td><td>No</td><td>I don&rsquo;t care about encryption but will pay the overhead of encryption if the server supports it</td></tr><tr><td>require</td><td>Yes</td><td>No</td><td>I want my data to be encrypted, and I accept the overhead. I trust that the network will make sure I always connect to the server I want.</td></tr><tr><td>verify-ca</td><td>Yes</td><td>Depends on CA policy</td><td>I want my data encrypted, and I accept the overhead. I want to be sure that I connect to a server that I trust.</td></tr><tr><td>verify-full</td><td>Yes</td><td>Yes</td><td>I want my data encrypted, and I accept the overhead. I want to be sure that I connect to a server I trust, and that it&rsquo;s the one I specify.</td></tr></tbody></table><h3 id=note>Note</h3><p>If you are using Java&rsquo;s default mechanism (not LibPQFactory) to create the SSL connection you will
need to make the server certificate available to Java, the first step is to convert
it to a form Java understands.</p><p><code>openssl x509 -in server.crt -out server.crt.der -outform der</code></p><p>From here the easiest thing to do is import this certificate into Java&rsquo;s system
truststore.</p><p><code>keytool -keystore $JAVA_HOME/lib/security/cacerts -alias postgresql -import -file server.crt.der</code></p><p>The default password for the cacerts keystore is <code>changeit</code>. Setting the alias to postgresql
is not required. You may apply any name you wish.</p><p>If you do not have access to the system cacerts truststore you can create your
own truststore.</p><p><code>keytool -keystore mystore -alias postgresql -import -file server.crt.der</code></p><p>When starting your Java application you must specify this keystore and password
to use.</p><p><code>java -Djavax.net.ssl.trustStore=mystore -Djavax.net.ssl.trustStorePassword=mypassword com.mycompany.MyApp</code></p><p>In the event of problems extra debugging information is available by adding
<code>-Djavax.net.debug=ssl</code> to your command line.</p><h2 id=using-ssl-without-certificate-validation>Using SSL without Certificate Validation</h2><p>In some situations it may not be possible to configure your Java environment to
make the server certificate available, for example in an applet. For a large
scale deployment it would be best to get a certificate signed by recognized
certificate authority, but that is not always an option. The JDBC driver provides
an option to establish a SSL connection without doing any validation, but please
understand the risk involved before enabling this option.</p><p>A non-validating connection is established via a custom <code>SSLSocketFactory</code> class that is provided
with the driver. Setting the connection URL parameter <code>sslfactory=org.postgresql.ssl.NonValidatingFactory</code>
will turn off all SSL validation.</p><br><div class=prev__next><p><a title="Next page in Custom SSLSocketFactory" href=https://utkar-sh-ukla.github.io/testing/documentation/chapter4/ssl-factory/>Custom SSLSocketFactory | 10</a></p><p><a title="Previous page in Issuing a Query and Processing the Result" href=https://utkar-sh-ukla.github.io/testing/documentation/chapter5/query/>Issuing a Query and Processing the Result | 12</a></p></div></article><aside></aside></div></main><footer class=footer><div class=footer__items><div class=footer__items__links><ul><li>Pgjdbc</li><li><a href=https://jdbc.postgresql.org/documentation/publicapi/index.html>Public API</a></li><li><a href=https://www.postgresql.org/>About PostgreSql</a></li></ul></div><div class=footer__items__links><ul><li>Community</li><li><a href=https://jdbc.postgresql.org/documentation/publicapi/index.html>Slack</a></li><li><a href=https://www.postgresql.org/>Twitter</a></li><li><a href=https://www.postgresql.org/>Mailing List</a></li></ul></div><div class=footer__items__links><ul><li>More</li><li><a href=https://jdbc.postgresql.org/documentation/publicapi/index.html>FAQ</a></li><li><a href=https://www.postgresql.org/>Privacy</a></li><li><a href=https://www.postgresql.org/>License</a></li></ul></div></div><p class=copyright>Copyright © 1996-2022 The PostgreSQL Global Development Group</p></footer></body></html>