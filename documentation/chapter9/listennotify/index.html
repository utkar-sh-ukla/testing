<!doctype html><html><head><meta charset=utf-8><link rel=preload href=https://utkar-sh-ukla.github.io/testing/fonts/woff2/inria-sans-v14-latin-300.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://utkar-sh-ukla.github.io/testing/fonts/woff2/inria-sans-v14-latin-300italic.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://utkar-sh-ukla.github.io/testing/fonts/woff2/inria-sans-v14-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://utkar-sh-ukla.github.io/testing/fonts/woff2/inria-sans-v14-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://utkar-sh-ukla.github.io/testing/fonts/woff2/inria-sans-v14-latin-italic.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://utkar-sh-ukla.github.io/testing/fonts/woff2/inria-sans-v14-latin-700italic.woff2 as=font type=font/woff2 crossorigin><title>Listen / Notify | Pgjdbc</title><meta name=viewport content="width=device-width,minimum-scale=1"><link rel=stylesheet href=https://utkar-sh-ukla.github.io/testing/sass/main.ad8d39bcb73da9b9260850a40900e7af4477352c415da494ee27745e8ef7dc8f.css integrity="sha256-rY05vLc9qbkmCFCkCQDnr0R3NSxBXaSU7id0Xo733I8="><link rel=icon type=image/x-icon href=/favicon.ico></head><body><nav class=navbar role=navigation><a href=/testing><img src=/icons/postgreslogo.svg class=logo></a><div class=navbar__items><a href=/testing/download/ class=navbar__items__link>Download</a>
<a href=/testing/documentation/ class=navbar__items__link>Documentation</a>
<a href=/testing/community/ class=navbar__items__link>Community</a>
<a href=/testing/development/ class=navbar__items__link>Development</a></div><a href=https://github.com/pgjdbc/pgjdbc target=_blank><img src=/icons/github.svg class=github></a></nav><main role=main><div class=doc><nav role=navigation class=sidebar><ul role=list class=flow><li role=listitem><a href=/testing/documentation/setup/>Getting Started</a></li><li role=listitem><a href=/testing/documentation/use/>Initializing the Driver</a></li><li role=listitem><a href=/testing/documentation/ssl/>Using SSL</a></li><li role=listitem><a href=/testing/documentation/query/>Issuing a Query and Processing the Result</a></li><li role=listitem><a href=/testing/documentation/callproc/>Calling Stored Functions and Procedures</a></li><li role=listitem><a href=/testing/documentation/binary-data/>Storing Binary Data</a></li><li role=listitem><a href=/testing/documentation/escapes/>JDBC escapes</a></li><li role=listitem><a href=/testing/documentation/server-prepare/>PostgreSQL™ Extensions to the JDBC API</a></li><li role=listitem><a href=/testing/documentation/thread/>Using the Driver in a Multithreaded or a Servlet Environment</a></li><li role=listitem><a href=/testing/documentation/datasource/>Connection Pools and Data Sources</a></li><li role=listitem><a href=/testing/documentation/logging/>Logging using java.util.logging</a></li><li role=listitem><a href=/testing/documentation/reading/>Further Reading</a></li><li role=listitem><a href>chapter1</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter1/intro/>Introduction</a></li></ul></li><li role=listitem><a href>chapter10</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter10/thread/>Using the Driver in a Multithreaded or a Servlet Environment</a></li></ul></li><li role=listitem><a href>chapter11</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter11/datasource/>Connection Pools and Data Sources</a></li><li role=listitem><a href=/testing/documentation/chapter11/ds-cpds/>Application Servers ConnectionPoolDataSource</a></li><li role=listitem><a href=/testing/documentation/chapter11/ds-ds/>Applications DataSource</a></li><li role=listitem><a href=/testing/documentation/chapter11/jndi/>Data Sources and JNDI</a></li><li role=listitem><a href=/testing/documentation/chapter11/tomcat/>Tomcat setup</a></li></ul></li><li role=listitem><a href>chapter12</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter12/logging/>Logging using java.util.logging</a></li></ul></li><li role=listitem><a href>chapter13</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter13/reading/>Further Reading</a></li></ul></li><li role=listitem><a href>chapter2</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter2/setup/>Getting the Driver</a></li><li role=listitem><a href=/testing/documentation/chapter2/classpath/>Setting up the Class Path</a></li><li role=listitem><a href=/testing/documentation/chapter2/prepare/>Preparing the Database Server for JDBC</a></li><li role=listitem><a href=/testing/documentation/chapter2/your-database/>Creating a Database</a></li></ul></li><li role=listitem><a href>chapter3</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter3/use/>Importing JDBC</a></li><li role=listitem><a href=/testing/documentation/chapter3/load/>Loading the Driver</a></li><li role=listitem><a href=/testing/documentation/chapter3/connect/>Connecting to the Database</a></li></ul></li><li role=listitem><a href>chapter4</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter4/ssl/>Configuring the Server</a></li><li role=listitem><a href=/testing/documentation/chapter4/ssl-client/>Configuring the Client</a></li><li role=listitem><a href=/testing/documentation/chapter4/ssl-factory/>Custom SSLSocketFactory</a></li></ul></li><li role=listitem><a href>chapter5</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter5/query/>Issuing a Query and Processing the Result</a></li><li role=listitem><a href=/testing/documentation/chapter5/statement/>Using the Statement or PreparedStatement Interface</a></li><li role=listitem><a href=/testing/documentation/chapter5/resultset/>Using the ResultSet Interface</a></li><li role=listitem><a href=/testing/documentation/chapter5/update/>Performing Updates</a></li><li role=listitem><a href=/testing/documentation/chapter5/ddl/>Creating and Modifying Database Objects</a></li><li role=listitem><a href=/testing/documentation/chapter5/java8-date-time/>Using Java 8 Date and Time classes</a></li></ul></li><li role=listitem><a href>chapter6</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter6/callproc/>Calling Stored Functions and Procedures</a></li></ul></li><li role=listitem><a href>chapter7</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter7/binary-data/>Storing Binary Data</a></li></ul></li><li role=listitem><a href>chapter8</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter8/escapes/>JDBC escapes</a></li><li role=listitem><a href=/testing/documentation/chapter8/outer-joins-escape/>Escape for outer joins</a></li><li role=listitem><a href=/testing/documentation/chapter8/escapes-datetime/>Date-time escapes</a></li><li role=listitem><a href=/testing/documentation/chapter8/escaped-functions/>Escaped scalar functions</a></li></ul></li><li role=listitem><a href>chapter9</a><ul role=list><li role=listitem><a href=/testing/documentation/chapter9/ext/>PostgreSQL™ Extensions to the JDBC API</a></li><li role=listitem><a href=/testing/documentation/chapter9/geometric/>Geometric Data Types</a></li><li role=listitem><a href=/testing/documentation/chapter9/largeobjects/>Large Objects</a></li><li role=listitem><a href=/testing/documentation/chapter9/listennotify/>Listen / Notify</a></li><li role=listitem><a href=/testing/documentation/chapter9/server-prepare/>Server Prepared Statements</a></li><li role=listitem><a href=/testing/documentation/chapter9/parameterstatus/>Parameter Status Messages</a></li><li role=listitem><a href=/testing/documentation/chapter9/replication/>Physical and Logical replication API</a></li><li role=listitem><a href=/testing/documentation/chapter9/arrays/>Arrays</a></li></ul></li></ul></nav><article class="article flow"><p>Listen and Notify provide a simple form of signal or interprocess communication
mechanism for a collection of processes accessing the same PostgreSQL™ database.
For more information on notifications consult the main server documentation. This
section only deals with the JDBC specific aspects of notifications.</p><p>Standard <code>LISTEN</code>, <code>NOTIFY</code>, and <code>UNLISTEN</code> commands are issued via the standard
<code>Statement</code> interface. To retrieve and process retrieved notifications the
<code>Connection</code> must be cast to the PostgreSQL™ specific extension interface
<code>PGConnection</code>. From there the <code>getNotifications()</code> method can be used to retrieve
any outstanding notifications.</p><h3 id=note>Note <a class=header-link href=#note><svg height="22" viewBox="0 0 24 24" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"/></svg></a></h3><blockquote><p>A key limitation of the JDBC driver is that it cannot receive asynchronous
notifications and must poll the backend to check if any notifications were issued.
A timeout can be given to the poll function, but then the execution of statements
from other threads will block.</p></blockquote><p><strong>Example 9.2. Receiving Notifications</strong></p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kn>import</span> <span class=nn>java.sql.*</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>NotificationTest</span>
<span class=o>{</span>
	<span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span> <span class=n>args</span><span class=o>[])</span> <span class=kd>throws</span> <span class=n>Exception</span>
	<span class=o>{</span>
		<span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;org.postgresql.Driver&#34;</span><span class=o>);</span>
		<span class=n>String</span> <span class=n>url</span> <span class=o>=</span> <span class=s>&#34;jdbc:postgresql://localhost:5432/test&#34;</span><span class=o>;</span>

		<span class=c1>// Create two distinct connections, one for the notifier
</span><span class=c1></span>		<span class=c1>// and another for the listener to show the communication
</span><span class=c1></span>		<span class=c1>// works across connections although this example would
</span><span class=c1></span>		<span class=c1>// work fine with just one connection.
</span><span class=c1></span>
		<span class=n>Connection</span> <span class=n>lConn</span> <span class=o>=</span> <span class=n>DriverManager</span><span class=o>.</span><span class=na>getConnection</span><span class=o>(</span><span class=n>url</span><span class=o>,</span><span class=s>&#34;test&#34;</span><span class=o>,</span><span class=s>&#34;&#34;</span><span class=o>);</span>
		<span class=n>Connection</span> <span class=n>nConn</span> <span class=o>=</span> <span class=n>DriverManager</span><span class=o>.</span><span class=na>getConnection</span><span class=o>(</span><span class=n>url</span><span class=o>,</span><span class=s>&#34;test&#34;</span><span class=o>,</span><span class=s>&#34;&#34;</span><span class=o>);</span>

		<span class=c1>// Create two threads, one to issue notifications and
</span><span class=c1></span>		<span class=c1>// the other to receive them.
</span><span class=c1></span>
		<span class=n>Listener</span> <span class=n>listener</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Listener</span><span class=o>(</span><span class=n>lConn</span><span class=o>);</span>
		<span class=n>Notifier</span> <span class=n>notifier</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Notifier</span><span class=o>(</span><span class=n>nConn</span><span class=o>);</span>
		<span class=n>listener</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
		<span class=n>notifier</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
	<span class=o>}</span>
<span class=o>}</span>

<span class=kd>class</span> <span class=nc>Listener</span> <span class=kd>extends</span> <span class=n>Thread</span>
<span class=o>{</span>
	<span class=kd>private</span> <span class=n>Connection</span> <span class=n>conn</span><span class=o>;</span>
	<span class=kd>private</span> <span class=n>org</span><span class=o>.</span><span class=na>postgresql</span><span class=o>.</span><span class=na>PGConnection</span> <span class=n>pgconn</span><span class=o>;</span>

	<span class=n>Listener</span><span class=o>(</span><span class=n>Connection</span> <span class=n>conn</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>SQLException</span>
	<span class=o>{</span>
		<span class=k>this</span><span class=o>.</span><span class=na>conn</span> <span class=o>=</span> <span class=n>conn</span><span class=o>;</span>
		<span class=k>this</span><span class=o>.</span><span class=na>pgconn</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=na>unwrap</span><span class=o>(</span><span class=n>org</span><span class=o>.</span><span class=na>postgresql</span><span class=o>.</span><span class=na>PGConnection</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
		<span class=n>Statement</span> <span class=n>stmt</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=na>createStatement</span><span class=o>();</span>
		<span class=n>stmt</span><span class=o>.</span><span class=na>execute</span><span class=o>(</span><span class=s>&#34;LISTEN mymessage&#34;</span><span class=o>);</span>
		<span class=n>stmt</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
	<span class=o>}</span>

	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span>
	<span class=o>{</span>
		<span class=k>try</span>
		<span class=o>{</span>
			<span class=k>while</span> <span class=o>(</span><span class=kc>true</span><span class=o>)</span>
			<span class=o>{</span>
				<span class=n>org</span><span class=o>.</span><span class=na>postgresql</span><span class=o>.</span><span class=na>PGNotification</span> <span class=n>notifications</span><span class=o>[]</span> <span class=o>=</span> <span class=n>pgconn</span><span class=o>.</span><span class=na>getNotifications</span><span class=o>();</span>

				<span class=c1>// If this thread is the only one that uses the connection, a timeout can be used to
</span><span class=c1></span>				<span class=c1>// receive notifications immediately:
</span><span class=c1></span>				<span class=c1>// org.postgresql.PGNotification notifications[] = pgconn.getNotifications(10000);
</span><span class=c1></span>
				<span class=k>if</span> <span class=o>(</span><span class=n>notifications</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span>
				<span class=o>{</span>
					<span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>notifications</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span>
						<span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Got notification: &#34;</span> <span class=o>+</span> <span class=n>notifications</span><span class=o>[</span><span class=n>i</span><span class=o>].</span><span class=na>getName</span><span class=o>());</span>
				<span class=o>}</span>

				<span class=c1>// wait a while before checking again for new
</span><span class=c1></span>				<span class=c1>// notifications
</span><span class=c1></span>
				<span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>500</span><span class=o>);</span>
			<span class=o>}</span>
		<span class=o>}</span>
		<span class=k>catch</span> <span class=o>(</span><span class=n>SQLException</span> <span class=n>sqle</span><span class=o>)</span>
		<span class=o>{</span>
			<span class=n>sqle</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
		<span class=o>}</span>
		<span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>ie</span><span class=o>)</span>
		<span class=o>{</span>
			<span class=n>ie</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
		<span class=o>}</span>
	<span class=o>}</span>
<span class=o>}</span>

<span class=kd>class</span> <span class=nc>Notifier</span> <span class=kd>extends</span> <span class=n>Thread</span>
<span class=o>{</span>
	<span class=kd>private</span> <span class=n>Connection</span> <span class=n>conn</span><span class=o>;</span>

	<span class=kd>public</span> <span class=nf>Notifier</span><span class=o>(</span><span class=n>Connection</span> <span class=n>conn</span><span class=o>)</span>
	<span class=o>{</span>
		<span class=k>this</span><span class=o>.</span><span class=na>conn</span> <span class=o>=</span> <span class=n>conn</span><span class=o>;</span>
	<span class=o>}</span>

	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span>
	<span class=o>{</span>
		<span class=k>while</span> <span class=o>(</span><span class=kc>true</span><span class=o>)</span>
		<span class=o>{</span>
			<span class=k>try</span>
			<span class=o>{</span>
				<span class=n>Statement</span> <span class=n>stmt</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=na>createStatement</span><span class=o>();</span>
				<span class=n>stmt</span><span class=o>.</span><span class=na>execute</span><span class=o>(</span><span class=s>&#34;NOTIFY mymessage&#34;</span><span class=o>);</span>
				<span class=n>stmt</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
				<span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>2000</span><span class=o>);</span>
			<span class=o>}</span>
			<span class=k>catch</span> <span class=o>(</span><span class=n>SQLException</span> <span class=n>sqle</span><span class=o>)</span>
			<span class=o>{</span>
				<span class=n>sqle</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
			<span class=o>}</span>
			<span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>ie</span><span class=o>)</span>
			<span class=o>{</span>
				<span class=n>ie</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
			<span class=o>}</span>
		<span class=o>}</span>
	<span class=o>}</span>

<span class=o>}</span>
</code></pre></div><div class=pagination><p><a title="Next page in Large Objects" href=https://utkar-sh-ukla.github.io/testing/documentation/chapter9/largeobjects/>Large Objects | 26</a></p><p><a title="Previous page in Server Prepared Statements" href=https://utkar-sh-ukla.github.io/testing/documentation/chapter9/server-prepare/>Server Prepared Statements | 28</a></p></div></article></div></main><footer class=footer role=contentinfo><div class=footer__items><div class=footer__items__links><ul role=list><li>Pgjdbc</li><li><a href=https://jdbc.postgresql.org/documentation/publicapi/index.html>Public API</a></li><li><a href=https://www.postgresql.org/>About PostgreSql</a></li></ul></div><div class=footer__items__links><ul role=list><li>Community</li><li><a href=https://jdbc.postgresql.org/documentation/publicapi/index.html>Slack</a></li><li><a href=https://www.postgresql.org/>Twitter</a></li><li><a href=https://www.postgresql.org/>Mailing List</a></li></ul></div><div class=footer__items__links><ul role=list><li>More</li><li><a href=https://jdbc.postgresql.org/documentation/publicapi/index.html>FAQ</a></li><li><a href=https://www.postgresql.org/>Privacy</a></li><li><a href=https://www.postgresql.org/>License</a></li></ul></div></div><p class=copyright>Copyright © 1996-2022 The PostgreSQL Global Development Group</p></footer></body></html>