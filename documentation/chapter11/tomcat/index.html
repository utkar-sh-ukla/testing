<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <base href="https://utkar-sh-ukla.github.io/testing/">
    <title>
        
Pgjdbc | Tomcat setup

    </title><link rel="stylesheet" href="https://utkar-sh-ukla.github.io/testing/sass/main.2da49a37aa539f43ccc31a3550dc93716c502d3fd07a23d3f30387ed7dd9d366.css" integrity="sha256-LaSaN6pTn0PMwxo1UNyTcWxQLT/QeiPT8wOH7X3Z02Y=">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
</head>

<body>
    <nav class="nav">
    
    <a href="/testing">Home</a>
    
    <a class="nav__item" href="/testing/development/" title="">Development</a>
    
    <a class="nav__item" href="/testing/download/" title="">Download</a>
    
    <a class="nav__item" href="/testing/documentation/" title="">Documentation</a>
    
    <a class="nav__item" href="/testing/community/" title="">Community</a>
    
</nav>
    <main>
        
<article>
    <h1>Tomcat setup</h1>
    <p><h3 id="note">Note</h3>
<p>The postgresql.jar file must be placed in $CATALINA_HOME/common/lib in both
Tomcat 4 and 5.</p>
<p>The absolute easiest way to set this up in either tomcat instance is to use the
admin web application that comes with Tomcat, simply add the datasource to the
context you want to use it in.</p>
<p>Setup for Tomcat 4 place the following inside the &lt;Context&gt; tag inside
conf/server.xml</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Resource</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;jdbc/postgres&#34;</span> <span style="color:#a6e22e">scope=</span><span style="color:#e6db74">&#34;Shareable&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;javax.sql.DataSource&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;ResourceParams</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;jdbc/postgres&#34;</span><span style="color:#f92672">&gt;</span>
	<span style="color:#f92672">&lt;parameter&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>validationQuery<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>select version();<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/parameter&gt;</span>
	<span style="color:#f92672">&lt;parameter&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>url<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>jdbc:postgresql://localhost/davec<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/parameter&gt;</span>
	<span style="color:#f92672">&lt;parameter&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>password<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>davec<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/parameter&gt;</span>
	<span style="color:#f92672">&lt;parameter&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>maxActive<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>4<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/parameter&gt;</span>
	<span style="color:#f92672">&lt;parameter&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>maxWait<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>5000<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/parameter&gt;</span>
	<span style="color:#f92672">&lt;parameter&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>driverClassName<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>org.postgresql.Driver<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/parameter&gt;</span>
	<span style="color:#f92672">&lt;parameter&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>username<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>davec<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/parameter&gt;</span>
	<span style="color:#f92672">&lt;parameter&gt;</span>
		<span style="color:#f92672">&lt;name&gt;</span>maxIdle<span style="color:#f92672">&lt;/name&gt;</span>
		<span style="color:#f92672">&lt;value&gt;</span>2<span style="color:#f92672">&lt;/value&gt;</span>
	<span style="color:#f92672">&lt;/parameter&gt;</span>
<span style="color:#f92672">&lt;/ResourceParams&gt;</span>
</code></pre></div><p>Setup for Tomcat 5, you can use the above method, except that it goes inside the
&lt;DefaultContext&gt; tag inside the &lt;Host&gt; tag. eg. &lt;Host&gt; &hellip; &lt;DefaultContext&gt; &hellip;</p>
<p>Alternatively there is a conf/Catalina/hostname/context.xml file. For example
http://localhost:8080/servlet-example has a directory $CATALINA_HOME/conf/Catalina/localhost/servlet-example.xml file.
Inside this file place the above xml inside the &lt;Context&gt; tag</p>
<p>Then you can use the following code to access the connection.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> javax.naming.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.sql.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.sql.*<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DBTest</span>
<span style="color:#f92672">{</span>

	String foo <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Not Connected&#34;</span><span style="color:#f92672">;</span>
	<span style="color:#66d9ef">int</span> bar <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">()</span>
	<span style="color:#f92672">{</span>
		<span style="color:#66d9ef">try</span>
		<span style="color:#f92672">{</span>
			Context ctx <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> InitialContext<span style="color:#f92672">();</span>
			<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>ctx <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">)</span>
				<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Exception<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Boom - No Context&#34;</span><span style="color:#f92672">);</span>

			<span style="color:#75715e">// /jdbc/postgres is the name of the resource above
</span><span style="color:#75715e"></span>			DataSource ds <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>DataSource<span style="color:#f92672">)</span>ctx<span style="color:#f92672">.</span><span style="color:#a6e22e">lookup</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;java:comp/env/jdbc/postgres&#34;</span><span style="color:#f92672">);</span>

			<span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ds <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
			<span style="color:#f92672">{</span>
				Connection conn <span style="color:#f92672">=</span> ds<span style="color:#f92672">.</span><span style="color:#a6e22e">getConnection</span><span style="color:#f92672">();</span>

				<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>conn <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
				<span style="color:#f92672">{</span>
					foo <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Got Connection &#34;</span><span style="color:#f92672">+</span>conn<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
					Statement stmt <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span><span style="color:#a6e22e">createStatement</span><span style="color:#f92672">();</span>
					ResultSet rst <span style="color:#f92672">=</span> stmt<span style="color:#f92672">.</span><span style="color:#a6e22e">executeQuery</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select id, foo, bar from testdata&#34;</span><span style="color:#f92672">);</span>

					<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>rst<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">())</span>
					<span style="color:#f92672">{</span>
						foo<span style="color:#f92672">=</span>rst<span style="color:#f92672">.</span><span style="color:#a6e22e">getString</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>
						bar<span style="color:#f92672">=</span>rst<span style="color:#f92672">.</span><span style="color:#a6e22e">getInt</span><span style="color:#f92672">(</span>3<span style="color:#f92672">);</span>
					<span style="color:#f92672">}</span>
					conn<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
				<span style="color:#f92672">}</span>
			<span style="color:#f92672">}</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
		<span style="color:#f92672">{</span>
			e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>

	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getFoo</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> foo<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>

	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getBar</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> bar<span style="color:#f92672">;}</span>
<span style="color:#f92672">}</span>
</code></pre></div></p>
</article>

    </main>
    <hr>
    <footer>
    <div>
        <p>
            Copyright © 1996-2022 The PostgreSQL Global Development Group
        </p>
    </div>
</footer>

</body>

</html>